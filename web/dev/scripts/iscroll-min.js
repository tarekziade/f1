(function(){function a(f,c){this.element=typeof f=="object"?f:document.getElementById(f);this.wrapper=this.element.parentNode;this.is3d=("m11" in new WebKitCSSMatrix());var e="-webkit-transition-property:-webkit-transform;-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);-webkit-transition-duration:0;-webkit-transform:"+(this.is3d?"translate3d(0,0,0)":"translate(0,0)");this.element.setAttribute("style",e);this.options={bounce:this.is3d,momentum:this.is3d,checkDOMChanges:true,topOnDOMChanges:false,hScrollBar:true,vScrollBar:true,overflow:"auto"};if(typeof c=="object"){for(var d in c){this.options[d]=c[d]}}this.wrapper.style.overflow=this.options.overflow;this.refresh();window.addEventListener("orientationchange",this,false);this.element.addEventListener("touchstart",this,false);if(this.options.checkDOMChanges){this.element.addEventListener("DOMSubtreeModified",this,false)}}a.prototype={x:0,y:0,scrollBarTimeout:null,handleEvent:function(c){switch(c.type){case"touchstart":this.touchStart(c);break;case"touchmove":this.touchMove(c);break;case"touchend":this.touchEnd(c);break;case"webkitTransitionEnd":this.transitionEnd(c);break;case"orientationchange":this.refresh();break;case"DOMSubtreeModified":this.onDOMModified(c);break}},onDOMModified:function(c){this.refresh();if(this.options.topOnDOMChanges&&(this.x!=0||this.y!=0)){this.scrollTo(0,0,"0")}},refresh:function(){this.scrollWidth=this.wrapper.clientWidth;this.scrollHeight=this.wrapper.clientHeight;this.maxScrollX=this.scrollWidth-this.element.offsetWidth;this.maxScrollY=this.scrollHeight-this.element.offsetHeight;var d=this.x,c=this.y;if(this.scrollX){if(this.maxScrollX>=0){d=0}else{if(this.x<this.maxScrollX){d=this.maxScrollX}}}if(this.scrollY){if(this.maxScrollY>=0){c=0}else{if(this.y<this.maxScrollY){c=this.maxScrollY}}}if(d!=this.x||c!=this.y){this.setTransitionTime("0");this.setPosition(d,c,true)}this.scrollX=this.element.offsetWidth>this.scrollWidth?true:false;this.scrollY=this.element.offsetHeight>this.scrollHeight?true:false;if(this.options.hScrollBar&&this.scrollX){this.scrollBarX=(this.scrollBarX instanceof b)?this.scrollBarX:new b("horizontal",this.wrapper);this.scrollBarX.init(this.scrollWidth,this.element.offsetWidth)}else{if(this.scrollBarX){this.scrollBarX=this.scrollBarX.remove()}}if(this.options.vScrollBar&&this.scrollY){this.scrollBarY=(this.scrollBarY instanceof b)?this.scrollBarY:new b("vertical",this.wrapper);this.scrollBarY.init(this.scrollHeight,this.element.offsetHeight)}else{if(this.scrollBarY){this.scrollBarY=this.scrollBarY.remove()}}},setPosition:function(c,e,d){this.x=c;this.y=e;this.element.style.webkitTransform=this.is3d?"translate3d("+this.x+"px,"+this.y+"px,0px)":"translate("+this.x+"px,"+this.y+"px)";if(!d){if(this.scrollBarX){this.scrollBarX.setPosition(this.x)}if(this.scrollBarY){this.scrollBarY.setPosition(this.y)}}},setTransitionTime:function(c){c=c||"0";this.element.style.webkitTransitionDuration=c;if(this.scrollBarX){this.scrollBarX.bar.style.webkitTransitionDuration=c+(this.is3d?",200ms":"")}if(this.scrollBarY){this.scrollBarY.bar.style.webkitTransitionDuration=c+(this.is3d?",200ms":"")}},touchStart:function(d){if(d.targetTouches.length!=1){return false}d.preventDefault();d.stopPropagation();this.setTransitionTime();if(this.options.momentum){var c=new WebKitCSSMatrix(window.getComputedStyle(this.element).webkitTransform);if(c.e!=this.x||c.f!=this.y){this.element.removeEventListener("webkitTransitionEnd",this,false);this.setPosition(c.e,c.f)}}if(this.scrollBarTimeout){clearTimeout(this.scrollBarTimeout);this.scrollBarTimeout=null}this.touchStartX=d.touches[0].pageX;this.scrollStartX=this.x;this.touchStartY=d.touches[0].pageY;this.scrollStartY=this.y;this.scrollStartTime=d.timeStamp;this.moved=false;this.element.addEventListener("touchmove",this,false);this.element.addEventListener("touchend",this,false)},touchMove:function(g){if(g.targetTouches.length!=1){return false}var d=this.scrollX===true?g.touches[0].pageX-this.touchStartX:0,c=this.scrollY===true?g.touches[0].pageY-this.touchStartY:0,h=this.x+d,f=this.y+c;if(h>0||h<this.maxScrollX){h=this.options.bounce?Math.round(this.x+d/4):this.x}if(f>0||f<this.maxScrollY){f=this.options.bounce?Math.round(this.y+c/4):this.y}this.setPosition(h,f);this.touchStartX=g.touches[0].pageX;this.touchStartY=g.touches[0].pageY;this.moved=true;if(g.timeStamp-this.scrollStartTime>250){this.scrollStartX=this.x;this.scrollStartY=this.y;this.scrollStartTime=g.timeStamp}},touchEnd:function(j){this.element.removeEventListener("touchmove",this,false);this.element.removeEventListener("touchend",this,false);var g=j.timeStamp-this.scrollStartTime;if(!this.moved){this.resetPosition();var k=j.changedTouches[0].target;while(k.nodeType!=1){k=k.parentNode}var l=document.createEvent("MouseEvents");l.initMouseEvent("click",true,true,j.view,1,k.screenX,k.screenY,k.clientX,k.clientY,j.ctrlKey,j.altKey,j.shiftKey,j.metaKey,0,null);k.dispatchEvent(l);return false}if(!this.options.momentum||g>250){this.resetPosition();return false}var d=this.scrollX===true?this.momentum(this.x-this.scrollStartX,g,this.options.bounce?-this.x+this.scrollWidth/3:-this.x,this.options.bounce?this.x+this.element.offsetWidth-this.scrollWidth+this.scrollWidth/3:this.x+this.element.offsetWidth-this.scrollWidth):{dist:0,time:0};var c=this.scrollY===true?this.momentum(this.y-this.scrollStartY,g,this.options.bounce?-this.y+this.scrollHeight/3:-this.y,this.options.bounce?this.y+this.element.offsetHeight-this.scrollHeight+this.scrollHeight/3:this.y+this.element.offsetHeight-this.scrollHeight):{dist:0,time:0};if(!d.dist&&!c.dist){this.resetPosition();return false}var f=Math.max(Math.max(d.time,c.time),1);var i=this.x+d.dist;var h=this.y+c.dist;this.scrollTo(i,h,f+"ms")},transitionEnd:function(){this.element.removeEventListener("webkitTransitionEnd",this,false);this.resetPosition()},resetPosition:function(e){var f=this.x,d=this.y,c=this,e=e||"600ms";if(this.x>=0){f=0}else{if(this.x<this.maxScrollX){f=this.maxScrollX}}if(this.y>=0){d=0}else{if(this.y<this.maxScrollY){d=this.maxScrollY}}if(f!=this.x||d!=this.y){this.setTransitionTime(e);this.setPosition(f,d)}if(this.scrollBarX||this.scrollBarY){if(this.scrollBarTimeout){clearTimeout(this.scrollBarTimeout);this.scrollBarTimeout=null}this.scrollBarTimeout=setTimeout(function(){if(c.scrollBarX){c.scrollBarX.hide()}if(c.scrollBarY){c.scrollBarY.hide()}},200)}},scrollTo:function(d,c,e){this.element.addEventListener("webkitTransitionEnd",this,false);this.setTransitionTime(e||"450ms");this.setPosition(d,c)},momentum:function(j,d,h,c){var g=2,i=2.5,e=Math.abs(j)/d*1000,f=e*e/g/1000,k=0;if(j>0&&f>h){e=e*h/f;f=h}if(j<0&&f>c){e=e*c/f;f=c}f=f*(j<0?-1:1);k=e/i;return{dist:Math.round(f),time:Math.round(k)}}};var b=function(c,e){this.is3d=("m11" in new WebKitCSSMatrix());this.dir=c;this.bar=document.createElement("div");this.bar.className="scrollbar "+c;var d="-webkit-transition-timing-function:cubic-bezier(0,0,0.25,1);pointer-events:none;opacity:0;"+(this.is3d?"-webkit-transition-duration:0,200ms;-webkit-transition-property:-webkit-transform,opacity;-webkit-transform:translate3d(0,0,0)":"-webkit-transition-duration:0;-webkit-transition-property:webkit-transform;-webkit-transform:translate(0,0)");this.bar.setAttribute("style",d);e.appendChild(this.bar)};b.prototype={init:function(c,d){var e=this.dir=="horizontal"?this.bar.offsetWidth-this.bar.clientWidth:this.bar.offsetHeight-this.bar.clientHeight;this.maxSize=c-8;this.size=Math.round(this.maxSize*this.maxSize/d)+e;this.maxScroll=this.maxSize-this.size;this.toWrapperProp=this.maxScroll/(c-d);this.bar.style[this.dir=="horizontal"?"width":"height"]=(this.size-e)+"px"},setPosition:function(d,c){if(!c&&this.bar.style.opacity!="1"){this.show()}d=this.toWrapperProp*d;if(d<0){d=0}else{if(d>this.maxScroll){d=this.maxScroll}}if(this.is3d){d=this.dir=="horizontal"?"translate3d("+Math.round(d)+"px,0,0)":"translate3d(0,"+Math.round(d)+"px,0)"}else{d=this.dir=="horizontal"?"translate("+Math.round(d)+"px,0)":"translate(0,"+Math.round(d)+"px)"}this.bar.style.webkitTransform=d},show:function(){this.bar.style.opacity="1"},hide:function(){this.bar.style.opacity="0"},remove:function(){this.bar.parentNode.removeChild(this.bar);return null}};window.iScroll=a})();